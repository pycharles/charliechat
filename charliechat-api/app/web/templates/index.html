<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Charlie Chat</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/main.css?v=20250916-21">
  </head>
  <body>
    <main class="page">
      <header class="navbar">
        <div class="navbar-top">
          <div class="navbar-brand">
            <a href="/" class="avatar">CO</a>
            <div class="brand-text">
              <h1 class="brand">Charlie Chat</h1>
              <p class="tagline">Beyond the Paper: A Conversation with My Career</p>
            </div>
          </div>
          
          <div class="navbar-actions">
            <!-- Social Links -->
            <div class="social-links">
              <a class="social-link" href="https://www.linkedin.com/in/charlesob/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn: charlesob" title="LinkedIn: charlesob">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path fill="currentColor" d="M20.447 20.452h-3.554v-5.569c0-1.328-.025-3.036-1.85-3.036-1.853 0-2.136 1.447-2.136 2.944v5.661H9.353V9h3.414v1.561h.049c.476-.9 1.637-1.85 3.369-1.85 3.602 0 4.268 2.37 4.268 5.455v6.286zM5.337 7.433a2.062 2.062 0 1 1 0-4.124 2.062 2.062 0 0 1 0 4.124zM6.997 20.452H3.671V9h3.326v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.73v20.541C0 23.226.792 24 1.771 24h20.451C23.2 24 24 23.226 24 22.271V1.73C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
              <a class="social-link" href="https://github.com/pycharles/" target="_blank" rel="noopener noreferrer" aria-label="GitHub: pycharles" title="GitHub: pycharles">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path fill="currentColor" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
        
        <nav class="navbar-nav">
          <a href="#" class="nav-link active" data-tab="chat">Chat</a>
          <a href="#" class="nav-link" data-tab="bio">Bio</a>
          <a href="#" class="nav-link" data-tab="journal">Dev Journal</a>
          <a href="#" class="nav-link" data-tab="contact">Contact</a>
        </nav>
      </header>

      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Chat Tab Content -->
        <div class="tab-content active" id="chat-tab">
          <div class="chat" id="chat">
            <div class="message message-bot">
              <div class="bubble">Hi, I'm Charlie. Ask me anything.</div>
            </div>
          </div>
          
          <!-- Voice Style Selector - Top Right of Chat -->
          <div class="chat-voice-selector">
            <button class="voice-style-btn" data-style="ninja" title="Change voice style to ninja" aria-label="Change voice style to ninja">
              <img src="/static/ninja-star.svg" class="voice-icon" width="18" height="18" alt="Ninja">
            </button>
            <button class="voice-style-btn" data-style="pirate" title="Change voice style to pirate" aria-label="Change voice style to pirate">
              <img src="/static/pirate01.svg" class="voice-icon" width="18" height="18" alt="Pirate">
            </button>
            <button class="voice-style-btn" data-style="surfer" title="Change voice style to surfer dude" aria-label="Change voice style to surfer dude">
              <img src="/static/wave01.svg" class="voice-icon" width="18" height="18" alt="Surfer">
            </button>
            <button class="voice-style-btn active" data-style="normal" title="Change voice style back to normal" aria-label="Change voice style back to normal">
              <img src="/static/person.svg" class="voice-icon" width="18" height="18" alt="Normal">
            </button>
          </div>
          
          <div class="composer-container">
            <form class="composer" hx-post="/chat" hx-target="#chat" hx-swap="beforeend" hx-trigger="submit" hx-reset="true" hx-on::before-request="const chat=document.getElementById('chat'); const input=this.querySelector('.composer-input'); const text=(input && input.value || '').trim(); if(!text){event.preventDefault(); return;} const userDiv=document.createElement('div'); userDiv.className='message message-user fade-in'; userDiv.innerHTML='<div class=\'bubble\'></div>'; userDiv.querySelector('.bubble').textContent=text; chat.appendChild(userDiv); let pending=document.getElementById('bot-pending'); if(pending) pending.remove(); pending=document.createElement('div'); pending.id='bot-pending'; pending.className='message message-bot pending fade-in'; pending.innerHTML='<div class=\'bubble\'><div class=\'thinking-dots\'><span class=\'thinking-dot\'></span><span class=\'thinking-dot\'></span><span class=\'thinking-dot\'></span></div></div>'; chat.appendChild(pending); chat.scrollTop=chat.scrollHeight;" hx-on::after-request="this.reset()" hx-disabled-elt=".composer-input, .composer-send">
              <input type="hidden" name="session_id" value="web-session">
              <input type="hidden" name="voice_style" id="voice_style_input" value="normal">
              <input class="composer-input" type="text" name="text" placeholder="Type your message..." autocomplete="off" required>
              <button class="composer-send" type="submit">Send</button>
            </form>
            
            <!-- Feedback Button - Above Send Button -->
            <button class="chat-feedback-btn" id="chat-feedback-fab" aria-label="Give Feedback" title="Give Feedback">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
                <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <span class="feedback-text">Feedback</span>
            </button>
          </div>
        </div>

        <!-- Dev Journal Tab Content -->
        <div class="tab-content" id="journal-tab">
          <div class="journal-layout">
            <!-- Left Navigation -->
            <nav class="journal-nav">
              <div class="journal-nav-header">
                <h3>Journal Sections</h3>
                <button class="nav-toggle" aria-label="Toggle navigation">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                  </svg>
                </button>
              </div>
              <div class="journal-nav-content">
                <a href="#" class="nav-item active" data-section="htmx-vs-react">
                  <span class="nav-date">2024-01-13</span>
                  <span class="nav-title">HTMX vs React</span>
                </a>
                <a href="#" class="nav-item" data-section="terraform-modularization">
                  <span class="nav-date">2024-01-14</span>
                  <span class="nav-title">Terraform Modularization</span>
                </a>
                <a href="#" class="nav-item" data-section="building-charlie-chat">
                  <span class="nav-date">2024-01-15</span>
                  <span class="nav-title">Building Charlie Chat</span>
                </a>
              </div>
            </nav>

            <!-- Journal Content -->
            <div class="journal-content">
              <div class="journal-article" id="htmx-vs-react">
                <h2>HTMX vs React: A Developer's Perspective</h2>
                <div class="article-meta">
                  <span class="article-date">January 13, 2024</span>
                </div>
                <div class="article-content">
                  <p>After years of working with React and other modern frontend frameworks, I decided to explore HTMX for a recent project. Here's what I discovered...</p>
                  <!-- Content will be loaded dynamically -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </main>

    <!-- Footer -->
    <footer class="text-center text-gray-500 text-sm py-4">
      <p>
        ¬© 2025 Charles O'Brien. Released under the 
        <a href="/LICENSE" class="underline hover:text-gray-700">MIT License</a>.
      </p>
    </footer>

    <!-- Bio Modal -->
    <div class="bio-modal" id="bio-modal">
      <div class="bio-modal-overlay" id="bio-modal-overlay"></div>
      <div class="bio-modal-content">
        <div class="bio-modal-header">
          <h3>About Charles O'Brien</h3>
          <button class="bio-modal-close" id="bio-modal-close" aria-label="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="bio-content">
          <p>Charles O‚ÄôBrien is a technology leader who combines executive vision with deep technical expertise. He has directed security, infrastructure, and business systems teams, guiding companies through cloud transformation, M&A integration, and PCI compliance while working effectively within a variety of regulatory frameworks.</p>
          
          <p>He is skilled at identifying business needs and leading initiatives with clear roadmaps, delivery milestones, and measurable outcomes. Charles works closely with cross-functional teams to align technology with business goals and deliver results that matter.</p>

          <p>While he stays hands-on with cloud architecture, automation, and AI using AWS and Kubernetes, Charles is most proud of building strong, engaged teams. His leadership style emphasizes clarity, empowerment, and collaboration so that people do their best work. Outside of work, he enjoys outdoor activities and exploring new technologies.</p>
        </div>
      </div>
    </div>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedback-modal">
      <div class="feedback-modal-overlay" id="feedback-modal-overlay"></div>
      <div class="feedback-modal-content">
        <div class="feedback-modal-header">
          <h3>Quick Feedback</h3>
          <button class="feedback-modal-close" id="feedback-modal-close" aria-label="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <form class="feedback-form" id="feedback-form">
          <div class="feedback-form-group">
            <label for="feedback-text">Your feedback (max 300 characters):</label>
            <textarea 
              id="feedback-text" 
              name="text" 
              placeholder="Share your thoughts about Charlie Chat..."
              maxlength="300"
              rows="4"
            ></textarea>
            <div class="feedback-char-count">
              <span id="char-count">0</span>/300
            </div>
          </div>
          
          <div class="feedback-form-group">
            <label>How do you feel about your experience?</label>
            <div class="feedback-sentiment-options">
              <label class="sentiment-option">
                <input type="radio" name="sentiment" value="positive">
                <span class="sentiment-emoji">üëç</span>
                <span class="sentiment-label">Positive</span>
              </label>
              <label class="sentiment-option">
                <input type="radio" name="sentiment" value="neutral">
                <span class="sentiment-emoji">üòê</span>
                <span class="sentiment-label">Neutral</span>
              </label>
              <label class="sentiment-option">
                <input type="radio" name="sentiment" value="negative">
                <span class="sentiment-emoji">üëé</span>
                <span class="sentiment-label">Negative</span>
              </label>
            </div>
          </div>
          
          <div class="feedback-form-actions">
            <button type="button" class="feedback-cancel-btn" id="feedback-cancel">Cancel</button>
            <button type="submit" class="feedback-submit-btn" id="feedback-submit" disabled>Submit</button>
          </div>
        </form>
        
        <div class="feedback-success" id="feedback-success" style="display: none;">
          <div class="feedback-success-icon">‚úÖ</div>
          <h3>Thanks for your feedback!</h3>
          <p>Your input helps us improve Charlie Chat.</p>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script>
      // Keep input focused after submit for smoother chatting
      document.addEventListener('htmx:afterOnLoad', function () {
        const input = document.querySelector('.composer-input');
        if (input) input.focus();
        const chat = document.getElementById('chat');
        if (chat) {
          // Smooth scroll to bottom
          chat.scrollTo({
            top: chat.scrollHeight,
            behavior: 'smooth'
          });
        }
      });

        // Replace pending placeholder with bot response
        document.addEventListener('htmx:beforeSwap', function (evt) {
          const target = evt.detail.target;
          if (!target || target.id !== 'chat') return;
          const pending = document.getElementById('bot-pending');
          if (!pending) return;
          const html = evt.detail.xhr.responseText || '';
          const wrap = document.createElement('div');
          wrap.innerHTML = html;
          const botMessage = wrap.firstElementChild;
          if (!botMessage) return;
          
          // Add fade-in animation to bot response
          botMessage.classList.add('fade-in');
          
          pending.replaceWith(botMessage);
          evt.detail.shouldSwap = false; // prevent default append to #chat
          
          // Smooth scroll to bottom after bot response
          setTimeout(() => {
            const chat = document.getElementById('chat');
            if (chat) {
              chat.scrollTo({
                top: chat.scrollHeight,
                behavior: 'smooth'
              });
            }
          }, 100);
        });

        // Handle lambda timeout and connection errors
        document.addEventListener('htmx:responseError', function (evt) {
          const target = evt.detail.target;
          if (!target || target.id !== 'chat') return;
          
          const error = evt.detail.xhr.responseText || evt.detail.xhr.statusText || 'Unknown error';
          const status = evt.detail.xhr.status;
          
          // Check for specific lambda timeout errors
          if (error.includes('message channel closed') || 
              error.includes('A listener indicated an asynchronous response by returning true') ||
              error.includes('asynchronous response by returning true') ||
              status === 0 || 
              status === 500) {
            
            handleSessionError('Your session has expired. Please refresh the page to start a new conversation.');
          }
        });

        // Handle network errors
        document.addEventListener('htmx:sendError', function (evt) {
          const target = evt.detail.target;
          if (!target || target.id !== 'chat') return;
          
          handleSessionError('Connection error. Please check your internet connection and try again.');
        });

        // Handle any unhandled promise rejections (catches the specific lambda error)
        window.addEventListener('unhandledrejection', function(event) {
          console.log('Unhandled rejection caught:', event.reason);
          const error = event.reason;
          const errorMessage = error && error.message ? error.message : String(error);
          
          if (errorMessage.includes('message channel closed') || 
              errorMessage.includes('A listener indicated an asynchronous response by returning true') ||
              errorMessage.includes('asynchronous response by returning true') ||
              errorMessage.includes('listener indicated an asynchronous response')) {
            
            console.log('Lambda timeout error detected, handling...');
            event.preventDefault(); // Prevent the console error
            handleSessionError('Your session has expired. Please refresh the page to start a new conversation.');
          } else {
            console.log('Other unhandled rejection:', errorMessage);
          }
        });

        // Additional error handling for fetch/XMLHttpRequest errors
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
          return originalFetch.apply(this, args).catch(error => {
            console.log('Fetch error caught:', error);
            const errorMessage = error && error.message ? error.message : String(error);
            
            if (errorMessage.includes('message channel closed') || 
                errorMessage.includes('A listener indicated an asynchronous response by returning true') ||
                errorMessage.includes('asynchronous response by returning true') ||
                errorMessage.includes('listener indicated an asynchronous response')) {
              console.log('Lambda timeout error in fetch, handling...');
              handleSessionError('Your session has expired. Please refresh the page to start a new conversation.');
              throw error; // Re-throw to maintain normal error flow
            }
            throw error;
          });
        };

        // Global error handler for any remaining errors
        window.addEventListener('error', function(event) {
          console.log('Global error caught:', event.error);
          const error = event.error;
          const errorMessage = error && error.message ? error.message : String(error);
          
          if (errorMessage.includes('message channel closed') || 
              errorMessage.includes('A listener indicated an asynchronous response by returning true') ||
              errorMessage.includes('asynchronous response by returning true') ||
              errorMessage.includes('listener indicated an asynchronous response')) {
            
            console.log('Lambda timeout error in global handler, handling...');
            handleSessionError('Your session has expired. Please refresh the page to start a new conversation.');
          }
        });

        // Centralized error handling function
        function handleSessionError(message) {
          // Remove any pending message
          const pending = document.getElementById('bot-pending');
          if (pending) pending.remove();
          
          // Add error message
          const chat = document.getElementById('chat');
          const errorMessage = document.createElement('div');
          errorMessage.className = 'message message-bot fade-in';
          errorMessage.innerHTML = `
            <div class="bubble session-error">
              <div class="error-icon">‚ö†Ô∏è</div>
              <div class="error-content">
                <strong>${message}</strong><br>
                <button class="refresh-btn" onclick="window.location.reload()">Refresh Page</button>
              </div>
            </div>
          `;
          chat.appendChild(errorMessage);
          chat.scrollTop = chat.scrollHeight;
          
          // Disable the input
          const input = document.querySelector('.composer-input');
          const sendBtn = document.querySelector('.composer-send');
          if (input) {
            input.disabled = true;
            input.placeholder = 'Session expired - please refresh the page';
          }
          if (sendBtn) {
            sendBtn.disabled = true;
            sendBtn.textContent = 'Session Expired';
          }
        }


        // Navbar functionality
        function initNavbar() {
          const navLinks = document.querySelectorAll('.nav-link');
          const tabContents = document.querySelectorAll('.tab-content');
          
          navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
              e.preventDefault();
              const targetTab = this.getAttribute('data-tab');
              
              // Handle different tab types
              if (targetTab === 'bio') {
                openBioModal();
                return; // Don't change active states for modal actions
              } else if (targetTab === 'contact') {
                openContactModal();
                return; // Don't change active states for modal actions
              } else if (targetTab === 'journal') {
                // Handle journal navigation
                window.location.href = '/journal';
                return;
              }
              
              // Only change active states for actual tab switching
              navLinks.forEach(btn => btn.classList.remove('active'));
              tabContents.forEach(content => content.classList.remove('active'));
              
              // Add active class to clicked nav link
              this.classList.add('active');
              
              // Show corresponding tab content
              const targetContent = document.getElementById(`${targetTab}-tab`);
              if (targetContent) {
                targetContent.classList.add('active');
              }
              
              console.log('Switched to tab:', targetTab);
            });
          });
        }
        
        // Bio modal functionality
        function initBioModal() {
          const bioModal = document.getElementById('bio-modal');
          const bioOverlay = document.getElementById('bio-modal-overlay');
          const bioClose = document.getElementById('bio-modal-close');
          
          function openBioModal() {
            bioModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
          }
          
          function closeBioModal() {
            bioModal.style.display = 'none';
            document.body.style.overflow = 'auto';
          }
          
          // Event listeners
          bioOverlay.addEventListener('click', closeBioModal);
          bioClose.addEventListener('click', closeBioModal);
          
          // Close modal with Escape key
          document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && bioModal.style.display === 'flex') {
              closeBioModal();
            }
          });
          
          // Make openBioModal globally available
          window.openBioModal = openBioModal;
        }
        
        // Contact functionality
        function initContact() {
          function openContactModal() {
            // Build email dynamically to avoid scraping
            const email = 'charles.r.obrien' + '+' + 'charliechat' + '@gmail.com';
            
            // Copy email to clipboard
            navigator.clipboard.writeText(email).then(function() {
              // Show success notification
              showNotification('Email copied to clipboard! You can now paste it in your email client.', 'success');
            }).catch(function(err) {
              console.error('Could not copy text: ', err);
              // Fallback: show email in alert
              alert(`Email: ${email}\n\nPlease copy this email address to send a message.`);
            });
          }
          
          // Make openContactModal globally available
          window.openContactModal = openContactModal;
        }
        
        // Notification system
        function showNotification(message, type = 'info') {
          // Remove existing notification
          const existing = document.querySelector('.notification');
          if (existing) existing.remove();
          
          // Create notification element
          const notification = document.createElement('div');
          notification.className = `notification notification-${type}`;
          notification.innerHTML = `
            <div class="notification-content">
              <span class="notification-message">${message}</span>
              <button class="notification-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
            </div>
          `;
          
          // Add to page
          document.body.appendChild(notification);
          
          // Auto-remove after 5 seconds
          setTimeout(() => {
            if (notification.parentElement) {
              notification.remove();
            }
          }, 5000);
        }

        // Voice style selector functionality
        let currentVoiceStyle = 'normal';
        
        function initVoiceStyleSelector() {
          console.log('Initializing voice style selector...');
          const voiceButtons = document.querySelectorAll('.voice-style-btn');
          const voiceStyleInput = document.getElementById('voice_style_input');
          const chatVoiceSelector = document.querySelector('.chat-voice-selector');
          
          console.log('Found voice buttons:', voiceButtons.length);
          console.log('Found voice style input:', voiceStyleInput);
          console.log('Found chat voice selector:', chatVoiceSelector);
          
          // Make chat voice selector always visible but more prominent on hover
          const chat = document.getElementById('chat');
          if (chat && chatVoiceSelector) {
            // Voice selector is now always visible with reduced opacity
            chatVoiceSelector.classList.add('visible');
          }
          
          voiceButtons.forEach((button, index) => {
            console.log(`Button ${index}:`, button, 'data-style:', button.getAttribute('data-style'));
            
            // Set initial active state for the first button
            if (button.classList.contains('active')) {
              // CSS will handle the styling, just ensure the class is there
              button.classList.add('active');
            }
            
            button.addEventListener('click', function(e) {
              e.preventDefault();
              console.log('Button clicked:', this.getAttribute('data-style'));
              
              // Remove active class from all buttons
              voiceButtons.forEach(btn => {
                btn.classList.remove('active');
                console.log('Removed active from:', btn.getAttribute('data-style'));
              });
              
              // Add active class to clicked button
              this.classList.add('active');
              console.log('Added active to:', this.getAttribute('data-style'));
              
              // Update current voice style
              currentVoiceStyle = this.getAttribute('data-style');
              
              // Update the hidden input value
              if (voiceStyleInput) {
                voiceStyleInput.value = currentVoiceStyle;
                console.log('Updated input value to:', voiceStyleInput.value);
              }
              
              console.log('Voice style changed to:', currentVoiceStyle);
            });
          });
        }
        
        // Mobile navigation toggle
        function initMobileNav() {
          const navToggle = document.querySelector('.nav-toggle');
          const journalNav = document.querySelector('.journal-nav');
          
          if (navToggle && journalNav) {
            navToggle.addEventListener('click', function() {
              journalNav.classList.toggle('open');
            });
            
            // Close nav when clicking outside
            document.addEventListener('click', function(e) {
              if (!journalNav.contains(e.target) && !navToggle.contains(e.target)) {
                journalNav.classList.remove('open');
              }
            });
          }
        }
        
        // Journal navigation functionality
        function initJournalNav() {
          const navItems = document.querySelectorAll('.journal-nav .nav-item');
          const articles = document.querySelectorAll('.journal-article');
          
          navItems.forEach(item => {
            item.addEventListener('click', function(e) {
              e.preventDefault();
              const targetSection = this.getAttribute('data-section');
              
              // Remove active class from all nav items
              navItems.forEach(nav => nav.classList.remove('active'));
              
              // Add active class to clicked item
              this.classList.add('active');
              
              // Hide all articles
              articles.forEach(article => article.style.display = 'none');
              
              // Show target article
              const targetArticle = document.getElementById(targetSection);
              if (targetArticle) {
                targetArticle.style.display = 'block';
              }
              
              // Close mobile nav if open
              const journalNav = document.querySelector('.journal-nav');
              if (journalNav) {
                journalNav.classList.remove('open');
              }
            });
          });
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function() {
            initNavbar();
            initBioModal();
            initContact();
            initVoiceStyleSelector();
            initMobileNav();
            initJournalNav();
          });
        } else {
          initNavbar();
          initBioModal();
          initContact();
          initVoiceStyleSelector();
          initMobileNav();
          initJournalNav();
        }

        // Feedback modal functionality
        function initFeedbackModal() {
          const feedbackBtn = document.getElementById('chat-feedback-fab');
          const feedbackModal = document.getElementById('feedback-modal');
          const feedbackOverlay = document.getElementById('feedback-modal-overlay');
          const feedbackClose = document.getElementById('feedback-modal-close');
          const feedbackCancel = document.getElementById('feedback-cancel');
          const feedbackForm = document.getElementById('feedback-form');
          const feedbackText = document.getElementById('feedback-text');
          const feedbackSubmit = document.getElementById('feedback-submit');
          const charCount = document.getElementById('char-count');
          const feedbackSuccess = document.getElementById('feedback-success');
          const sentimentInputs = document.querySelectorAll('input[name="sentiment"]');

          // Open modal
          function openModal() {
            feedbackModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            feedbackText.focus();
          }

          // Close modal
          function closeModal() {
            feedbackModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            resetForm();
          }

          // Reset form
          function resetForm() {
            feedbackForm.style.display = 'block';
            feedbackSuccess.style.display = 'none';
            feedbackForm.reset();
            feedbackSubmit.disabled = true;
            charCount.textContent = '0';
          }

          // Update character count
          function updateCharCount() {
            const count = feedbackText.value.length;
            charCount.textContent = count;
            
            // Update submit button state
            const hasText = count > 0;
            const hasSentiment = document.querySelector('input[name="sentiment"]:checked');
            feedbackSubmit.disabled = !(hasText || hasSentiment);
          }

          // Event listeners
          feedbackBtn.addEventListener('click', openModal);
          feedbackOverlay.addEventListener('click', closeModal);
          feedbackClose.addEventListener('click', closeModal);
          feedbackCancel.addEventListener('click', closeModal);
          feedbackText.addEventListener('input', updateCharCount);
          
          sentimentInputs.forEach(input => {
            input.addEventListener('change', updateCharCount);
          });

          // Form submission
          feedbackForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(feedbackForm);
            const data = {
              text: formData.get('text').trim(),
              sentiment: formData.get('sentiment'),
              session_id: 'web-session'
            };

            if (!data.text && !data.sentiment) {
              alert('Please provide feedback text or select a sentiment.');
              return;
            }

            try {
              feedbackSubmit.disabled = true;
              feedbackSubmit.textContent = 'Submitting...';

              const response = await fetch('/feedback', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
              });

              if (response.ok) {
                // Show success message
                feedbackForm.style.display = 'none';
                feedbackSuccess.style.display = 'block';
                
                // Auto-close after 2 seconds
                setTimeout(() => {
                  closeModal();
                }, 2000);
              } else {
                const error = await response.json();
                alert(`Error: ${error.detail || 'Failed to submit feedback'}`);
              }
            } catch (error) {
              alert('Network error. Please try again.');
            } finally {
              feedbackSubmit.disabled = false;
              feedbackSubmit.textContent = 'Submit';
            }
          });

          // Close modal with Escape key
          document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && feedbackModal.style.display === 'flex') {
              closeModal();
            }
          });
        }

        // Initialize feedback modal
        initFeedbackModal();

      // Quick toggles to try background experiments
      function setBg(mode) {
        document.body.classList.remove('bg-full', 'bg-split');
        if (mode === 'full') document.body.classList.add('bg-full');
        if (mode === 'split') document.body.classList.add('bg-full', 'bg-split');
      }
    </script>
  </body>
  </html>


